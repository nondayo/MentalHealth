---
title: "Mental Health Disorder Analysis"
author: "MGT 6203 Team 5"
date: "4/2/2022"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

More people pay more attention to mental health than ever before. Top athletes, such as professional tennis player Naomi Osaka, legendary American swimmer Michael Phelps and NBA player Kevin Love, have shared their personal experiences and battles with mental health disorders, which includes Depression and Attention Deficit/Hyperactive Disorder (ADHD). Due to their fame status, they have managed to direct the public's attention to the prevalence and importance of mental health.

Over the years, there is an increase in people using meditation apps to relieve stress. This phenomenon is further exacerbated during the COVID-19 period. The [*global spending*](https://www2.deloitte.com/xe/en/insights/industry/technology/technology-media-and-telecom-predictions/2022/mental-health-app-market.html) on mental health and well-being apps increased from \$203 million in 2019 to \$269 million in 2020. This spending is estimated to jump from \$269 million in 2020 to \$372 million in 2021. [*One study*](https://www.nature.com/articles/d41586-021-00175-z) has also found that feelings of depression and anxiety increase by four fold in December 2020, as compared to the first half of 2019. According to the [*Wall Street Journal*](https://www.wsj.com/articles/headspace-vs-calm-the-meditation-battle-thats-anything-but-zen-11544889606), meditation apps have a $1.2 billion market and will continue to grow, showing a huge business potential.

It is well-known worldwide that healthcare workers are suffering from burnout and other mental disorders due to the pandemic. However, little is known about mental health in the tech industry. Thus, we want to do more research about mental health in the tech industry. We found [*mental health surveys*](https://osmhhelp.org/research) for the tech industry collected by [*Open Source Mental Health (OSMH)*](https://osmhhelp.org/about/about-osmi). The data has been collected since 2014. Here are some research questions that we hope to answer:

1. What are the factors that might explain cases of mental health disorders at the workplace?
2. Is family history a significant factor in determining one’s likelihood of developing mental health disorders?
3. How has the pandemic changed the prevalence of mental health disorders? 
4. How have the attitudes towards mental health been before or after the pandemic?

## Description of the datasets 

### Raw data

Here are the dataset(s) that we will be using:

1. [*OSMH/OSMI Mental Health in Tech Survey(2019)*](https://www.kaggle.com/osmihelp/osmi-mental-health-in-tech-survey-2019)
2. [*OSMH/OSMI Mental Health in Tech Survey(2020)*](https://www.kaggle.com/osmihelp/osmi-2020-mental-health-in-tech-survey-results)
3. [*OSMH/OSMI Mental Health in Tech Survey(2021)*](https://www.kaggle.com/osmihelp/osmh-2021-mental-health-in-tech-survey-results)

#### Description of dataset / key variables to analyze

We chose these 3 datasets because they are in consecutive years before (2019) and during the COVID-19 pandemic (2020-2021). The dataset provides data on attitudes towards mental health, as well as the frequency of mental health disorders in the tech workplace.

Dependent variable: Do you currently have a mental health disorder?
Independent variables: age, gender, family history, year (as an index of before or after the pandemic), etc.

### Cleaned data

After data manipulation, the data distribution are showed below.

![Data distribution](img/dataDistribution.png)

## Approach and Methodology

The dependent variable for our first research question is represented by the question “Do you currently have a mental health disorder?”. As there are 4 possible answers to this survey question, we have decided to use a multi-class classification model(i.e. What are the factors that might explain cases of mental health disorders at the workplace?). For the other research questions, we want to find the relationships between the two variables and will be using Chi-square test.

We choose the random forest model to make the classifier. Random forest, like its name implies, consists of a large number of individual decision trees that operate as an ensemble. Each individual tree in the random forest spits out a class prediction and the class with the most votes becomes our model’s prediction. It uses bagging and features randomness when building each individual tree to try to create an uncorrelated forest of trees whose prediction by the committee is more accurate than that of any individual tree.

Random forests also offer a good feature selection indicator. Random forest uses Gini importance or mean decrease in impurity (MDI) to calculate the importance of each feature. Gini importance is also known as the total decrease in node impurity. This is how much the model fit or accuracy decreases when you drop a variable. The larger the decrease, the more significant the variable is. Here, the mean decrease is a significant parameter for variable selection. The Gini index can describe the overall explanatory power of the variables. 

## Preliminary results

### Question 1: What are the factors that might explain cases of mental health disorders at the workplace?

We build a random forest model to predict ‘Do you currently have a mental health disorder’. The confusion matrix we have is as listed below.

```{r,include=FALSE}
library(dplyr)
library(randomForest)
```

```{r}
dat <- read.csv("eval/MentalHealth_2019to2021_required.csv", stringsAsFactors = T) 
# Select columns Manually
ColsManually <- read.csv("eval/columnsToModeling.csv")
cols <- ColsManually$column_name[!ColsManually$Factor == ""] %>% 
  as.character()
Data <- dat[,cols] 
names(Data) <- ColsManually$Factor[!ColsManually$Factor == ""] %>% 
  as.character()
Data$CurrentlyMentalHealthDisorder <- dat$`Do.you..currently..have.a.mental.health.disorder.`
```


```{r,include=FALSE}
library(randomForest)
```

```{r}
set.seed(5566)
ind <- sample(2, nrow(Data), replace = TRUE, prob = c(0.7, 0.3))
train <- Data[ind==1,]
test <- Data[ind==2,]
rf <- randomForest(CurrentlyMentalHealthDisorder ~ ., data=train, na.action = na.omit) 
print(rf)
```
The classifier does not perform well in predicting "Don’t know" and "Possibly" categories.

```
# Model performance in Testing set
Prediction <- predict(rf, test)
Reference <- test$CurrentlyMentalHealthDisorder
table(Prediction, Reference)
#                      Reference
# Prediction   Don't Know No Possibly Yes
#   Don't Know          1  1        0   1
#   No                  7 34       16  14
#   Possibly            3  5        3   4
#   Yes                 3 12       23  42

```

The feature importance of the model is listed below.

```{r}
varImpPlot(rf, sort = TRUE)
```

### Question 2: Is family history a significant factor in determining one’s likelihood of developing mental health disorders?

```{r}
library(dplyr)
dat <- read.csv("eval/MentalHealth_2019to2021_required.csv", stringsAsFactors = T)
tb <- table(dat$`Do.you..currently..have.a.mental.health.disorder.`,
            dat$`Do.you.have.a.family.history.of.mental.illness.`)
chi <- chisq.test(tb, correct = F)
chi$p.value
```

We run the chi-squared test and the resulting p-value here can be seen as a measure of the correlation between these two variables. Since the p-value < 0.05, we can reject the null hypothesis.
In other words, the relationship between family history of mental illness and having a mental health disorder is statistically significant.

### Question 3: How has the pandemic changed the prevalence of mental health disorders?

```{r}
dat <- read.csv("eval/MentalHealth_2019to2021_required.csv", stringsAsFactors = T) 
dat$disorder <- ifelse(dat$`Do.you..currently..have.a.mental.health.disorder.` == "Yes", "Yes", "No")
dat$Pandemic <- ifelse(dat$year < 2020, "Before", "After")
tb <- table(dat$disorder, 
            dat$Pandemic)
chi <- chisq.test(tb, correct = F)
chi$p.value
```

We run the chi-squared test and the resulting p-value here can be seen as a measure of the correlation between these two variables. Since the p-value < 0.05, we can reject the null hypothesis. In other words, the prevalence of mental health disorders is related to the pandemic.

### Question 4: How have the attitudes towards mental health been before or after the pandemic?

There are two features are associated with this research question:

1. Would you feel comfortable discussing a mental health issue with your direct supervisor?

```{r}
dat <- read.csv("eval/MentalHealth_2019to2021_required.csv", stringsAsFactors = T)
dat$DiscussWithSupervisor <- dat$`Would.you.feel.comfortable.discussing.a.mental.health.issue.with.your.direct.supervisor.s..`
dat$Pandemic <- ifelse(dat$year < 2020, "Before", "After")
tb <- table(dat$DiscussWithSupervisor, 
            dat$Pandemic)
chi <- chisq.test(tb, correct = F)
chi$p.value
```

2. Would you feel comfortable discussing a mental health issue with your coworkers?

```{r}
dat <- read.csv("eval/MentalHealth_2019to2021_required.csv", stringsAsFactors = T)
dat$DiscussWithCoworkers <- dat$`Would.you.feel.comfortable.discussing.a.mental.health.issue.with.your.coworkers.`
dat$Pandemic <- ifelse(dat$year < 2020, "Before", "After")
tb <- table(dat$DiscussWithCoworkers,
            dat$Pandemic)
chi <- chisq.test(tb, correct = F)
chi$p.value
```

We found that they have opposite results. The level of comfortableness discussing a mental health issue with the staff’s direct supervisor is different after the pandemic. On the contrary, there is no statistical difference in discussions with the staff’s coworkers.

## Detailed plan of action for the rest of the project

1. More details about how we do the data manipulation.
2. Provide more basic statistics charts to describe the data more precisely.
